<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tacosuke Works Catalog</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="age-check" class="overlay">
    <div class="modal">
      <h2>⚠️18歳未満の方はご退出ください</h2>
      <p>このサイトにはアダルトコンテンツを含みます。</p>
      <button id="enter-btn">はい、18歳以上です</button>
    </div>
  </div>

  <header>
    <h1>Tacosuke Works Catalog</h1>
  </header>

  <main>
    <div id="works-container" class="grid"></div>
  </main>

  <footer>
    <p>© 2025 Tacosuke</p>
  </footer>

  <script>
    // 年齢確認
    const overlay = document.getElementById('age-check');
    document.getElementById('enter-btn').onclick = () => {
      overlay.style.display = 'none';
    };

    // CSVパース用（"..."や改行を安全に処理）
    function parseCSV(text) {
      const rows = [];
      let current = [];
      let inQuotes = false;
      let value = '';

      for (let i = 0; i < text.length; i++) {
        const char = text[i];
        if (char === '"') {
          if (inQuotes && text[i + 1] === '"') {
            value += '"';
            i++;
          } else {
            inQuotes = !inQuotes;
          }
        } else if (char === ',' && !inQuotes) {
          current.push(value.trim());
          value = '';
        } else if (char === '\n' && !inQuotes) {
          current.push(value.trim());
          rows.push(current);
          current = [];
          value = '';
        } else {
          value += char;
        }
      }
      if (value) current.push(value.trim());
      if (current.length > 0) rows.push(current);
      return rows;
    }

    async function loadWorks() {
      const response = await fetch('https://docs.google.com/spreadsheets/d/1v0t7jK3EiajQtn2DC5Vl0MaxS2pXNBeFma63iSCGR0k/gviz/tq?tqx=out:csv');
      const data = await response.text();
      const rows = parseCSV(data);
      const header = rows.shift(); // ヘッダー除外

      const container = document.getElementById('works-container');
      rows.forEach(cols => {
        if (!cols.length || !cols[0]) return;

        const [title, desc, img, fanza, dlsite, booth, pictspace] = cols.map(v => v.replace(/^"|"$/g, ''));

        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${img}" alt="${title}">
          <h2>${title}</h2>
          <p>${desc}</p>
          <div class="links">
            ${fanza ? `<a href="${fanza}" target="_blank" class="btn fanza">FANZA</a>` : ''}
            ${dlsite ? `<a href="${dlsite}" target="_blank" class="btn dlsite">DLsite</a>` : ''}
            ${booth ? `<a href="${booth}" target="_blank" class="btn booth">BOOTH</a>` : ''}
            ${pictspace ? `<a href="${pictspace}" target="_blank" class="btn pictspace">pictSPACE</a>` : ''}
          </div>
        `;
        container.appendChild(card);
      });
    }

    loadWorks();
  </script>
</body>
</html>
